# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Development Commands

### Build and Development
- `npm run dev` - Start development server with HMR and PWA features
- `npm run build` - Build for production (runs TypeScript check + Vite build)
- `npm run preview` - Preview production build locally

### Code Quality
- `npm run lint` - Run ESLint with auto-fix on TypeScript files
- `npm run lint-fix` - Comprehensive linting and Prettier formatting
- `npm run lint-staged` - Run linting on staged files only (used by pre-commit hooks)

### Deployment
- `npm run deploy` - Deploy built files to dev server via SCP
- `npm run deploy-all` - Build and deploy in one command
- `npm run deploy-pwa` - Build and deploy using local script

### Pre-commit Hooks
The project uses Husky with lint-staged for automatic code quality enforcement. All staged files are automatically linted and formatted before commits.

## Architecture Overview

### Core Framework Stack
- **React 19** with TypeScript
- **Vite** for build tooling and development server
- **React Router** for client-side routing with data loaders
- **SWR** for data fetching and caching
- **Tailwind CSS** for styling
- **Jotai** for state management

### PWA Architecture
This is a full Progressive Web App with:
- **Service Worker**: Auto-generated by Vite PWA plugin with Workbox
- **Offline Support**: Network-first for API calls, cache-first for static assets
- **Install Prompt**: Custom React component (`PWAInstallPrompt.tsx`)
- **Offline Indicator**: Real-time network status monitoring

### State Management Pattern
The application uses a layered approach:
- **Context Providers**: Multiple specialized providers wrap the app tree
- **SWR**: For server state caching and synchronization
- **Jotai**: For client-side atomic state management
- **URL State**: Query parameters synced with application state via hash

### Key Provider Hierarchy
```
SWRConfig
  ├── TrackingProvider
  ├── GroupDesignerProvider
  ├── CompareProvider
  ├── TranslationProvider
  ├── NotificationsProvider
  └── ImpressionProvider
```

### Data Layer Architecture
- **API Layer**: `src/lib/datalayer/api.ts` - Centralized API functions
- **Streaming Support**: Real-time data streaming for search suggestions and results
- **Caching Strategy**: Multi-level caching with SWR + custom item cache
- **Query Management**: Complex query state management with URL synchronization

### Component Structure
- **Pages**: Main route components in `src/pages/`
- **Components**: Reusable UI components in `src/components/`
- **Hooks**: Custom hooks for specific functionality in `src/hooks/`
- **Context**: React contexts for shared state in `src/lib/hooks/`

### Development Server Configuration
The Vite dev server proxies multiple API endpoints:
- `/api` - Main search and product API
- `/location` - Store location services  
- `/cart`, `/checkout`, `/confirmation` - E-commerce endpoints
- `/admin` - Admin interface API
- `/tracking` - Analytics and tracking API

### Key Features
- **Search Interface**: Advanced faceted search with auto-suggestions
- **Admin Interface**: Product management, facet configuration, rules engine
- **Analytics Dashboard**: Query tracking, popular items, conversion funnels
- **E-commerce**: Product pages, comparison, cart functionality
- **Builder**: Component-based page builder system
- **Multi-language**: Translation system with locale detection

### Code Quality Standards
- **ESLint**: Strict TypeScript rules with React hooks enforcement
- **Unused Imports**: Treated as errors (auto-removed on save)
- **Prettier**: Consistent code formatting
- **Pre-commit**: Automatic linting and formatting enforcement
- **TypeScript**: Strict mode enabled with comprehensive type checking

### Deployment Strategy
- Production builds are deployed via SCP to remote server
- PWA assets are optimized and cached for offline functionality
- Bundle analysis available via `vite-bundle-analyzer`

## Key Files to Understand

### Core Application
- `src/main.tsx` - Application entry point with router configuration
- `src/pages/App.tsx` - Main search interface
- `src/lib/hooks/QueryProvider.tsx` - Central query state management
- `src/hooks/searchHooks.ts` - Search functionality and URL serialization

### Configuration
- `vite.config.ts` - Build configuration with PWA setup
- `package.json` - Scripts and dependencies
- `.eslintrc.cjs` - Code quality rules
- `tsconfig.json` - TypeScript configuration

### PWA Components
- `src/components/PWAInstallPrompt.tsx` - Install prompt UI
- `src/components/OfflineIndicator.tsx` - Network status indicator
- `src/hooks/usePWA.ts` - PWA functionality hook